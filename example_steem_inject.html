<script src="dist/beet-js.js"></script>
<script>
beet.init('beet-js example for steem').then(identities => {
    try {
        console.log("identities", identities);
        if (identities.length == 0) {
            beet.connect().then(res => {
                beet.link('STEEM').then(res => {
                    console.log("linked");
                }).catch((err) => {
                    console.error(err);
                });
            }).catch((err) => {
                console.error(err);
            });
        } else {
            beet.connect(identities[0]).then(res => {
                console.log("connected", res, );
                beet.getAccount().then(account => {
                    if (typeof account == "string") {
                        // fix bug that causes to return string instead of json
                        account = JSON.parse(account);
                    }
                    // this calls steem.broadcast.customJson(wif, requiredAuths, requiredPostingAuths, id, json, callback)
                    beet.injectedCall(
                        [
                            "customJson",  // operation name
                            "inject_wif",
                            [ account.account ],
                            [],
                            "beet",
                            JSON.stringify([
                                "broadcast-example",
                                {
                                    text: "This custom json data was put on Steem with Beet",
                                    url: "https://github.com/bitshares/beet"
                                }
                            ])
                        ]
                    ).then(res => {
                        console.log("injectedCall", res);
                    }).catch((err) => {
                        console.error("injectedCall", err);
                    });
                });
            }).catch((err) => {
                console.error(err);
            });

            // beet.connect(identities[0]).then(res => {
            //     console.log("connected", res);
            //     beet.voteFor(
            //         {
            //             author: "krazykrista",
            //             permlink: "bitshares-scam-do-not-accept-proposed-transactions-that-update-your-account-data",
            //             weight: 1
            //         }
            //     ).then(account => {
            //         console.log("voteFor", account);
            //     }).catch((err) => {
            //         console.error("voteFor", err);
            //     });
            // }).catch((err) => {
            //     console.error(err);
            // });
        }
    } catch (err) {
        console.error(err);
    }
}).catch((err) => {
    console.error(err);
});
</script>